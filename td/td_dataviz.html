<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="fr" xml:lang="fr">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Visualisation des données avec =Plotly=</title>
<meta name="author" content="Roland Donat" />
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/css/readtheorg.css"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/lib/js/jquery.stickytableheaders.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/js/readtheorg.js"></script>
<link rel="stylesheet" type="text/css" href="https://roland-donat.github.io/ubs/Charte_graphique/IUT/ubs_iut_vannes.css" />
<link rel="stylesheet" type="text/css" href="https://roland-donat.github.io/ubs-lpmds-python/custom.css" />
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "0em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "right",
               TagIndent: ".8em"
             }
});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML"></script>
</head>
<body>
<div id="content" class="content">
<h1 class="title">Visualisation des données avec <code>Plotly</code></h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table des matières</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orgff2001a">1. Contexte et objectif</a></li>
<li><a href="#sec:odds_df">2. Données de cotes</a>
<ul>
<li><a href="#orgb169c80">2.1. Présentation des données</a></li>
<li><a href="#orge0ddcd1">2.2. Chargement des données</a></li>
</ul>
</li>
<li><a href="#org8d1e77d">3. Premiers pas avec <code>plotly.express</code> : visualisation des cotes moyennes</a></li>
<li><a href="#org001ee81">4. Distribution des cotes</a>
<ul>
<li><a href="#org5c1f7e8">4.1. Utilisation d'un <i>boxplot</i></a></li>
<li><a href="#orgc84e452">4.2. Utilisation d'un histogramme</a></li>
</ul>
</li>
<li><a href="#org2ccfef8">5. Analyse des probabilités estimées par le bookmaker</a></li>
</ul>
</div>
</div>






<div id="org12874f1" class="figure">
<p><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/29/Minard.png/1920px-Minard.png" alt="1920px-Minard.png" />
</p>
<p><span class="figure-number">Figure&nbsp;1&nbsp;: </span>Carte figurative des pertes successives en hommes de l’Armée française dans la campagne de Russie en 1812-1813. Auteur <a href="https://fr.wikipedia.org/wiki/Charles_Joseph_Minard">Charles Joseph Minard</a>.  <a href="https://upload.wikimedia.org/wikipedia/commons/thumb/2/29/Minard.png/1920px-Minard.png">Source</a>.</p>
</div>


<div id="outline-container-orgff2001a" class="outline-2">
<h2 id="orgff2001a"><span class="section-number-2">1.</span> Contexte et objectif</h2>
<div class="outline-text-2" id="text-1">
<p>
L'objectif de ce TD est de parcourir les principales fonctionnalités de la librairie <code>Plotly</code> afin
d'explorer les données par le biais de techniques de visualisations modernes.
</p>

<p>
Nous étudierons en particulier le sous-module <code>Plotly.express</code> qui offre la possibilité de
construire aisément tous les graphiques usuels en y ajoutant des éléments d'interactivités.
</p>

<p>
Pour ce faire, nous utiliserons des données sur les cotes de matchs de foot.
</p>
</div>
</div>

<div id="outline-container-sec:odds_df" class="outline-2">
<h2 id="sec:odds_df"><span class="section-number-2">2.</span> Données de cotes</h2>
<div class="outline-text-2" id="text-sec:odds_df">
<p>
La notion de cote possède plusieurs définitions. Voici deux formulations usuelles qui sont en fait
toutes deux liées :
</p>
<ul class="org-ul">
<li>En probabilité, la cote, notée \(g_{E}\), associée à l'occurrence d'un événement \(E\) est défini par
le rapport des probabilités suivantes : 
\[
  g_{E} = \frac{\text{Prob}(\text{l'évenement $E$ ne se réalise pas})}{\text{Prob}(\text{l'événement
  $E$ se réalise})},
  \]
que l'on peut réécrire comme suit :
\[
  g_{E} = \frac{1 - p_{E}}{p_{E}} = \frac{1}{p_{E}} - 1,
  \]
en notant \(p_{E} = \text{Prob}(\text{l'événement E se réalise})\).</li>
<li>Dans le monde des bookmakers, la cote associée à l'occurrence d'un événement \(E\) est notée \(c_{E}\)
et a pour expression :
\[
  c_{E} = \frac{1}{p_{E}}.
  \]
On a donc la relation \(c_{E} = g_{E} + 1\) permettant de relier les deux notions de cotes.</li>
</ul>
</div>


<div id="outline-container-orgb169c80" class="outline-3">
<h3 id="orgb169c80"><span class="section-number-3">2.1.</span> Présentation des données</h3>
<div class="outline-text-3" id="text-2-1">
<p>
Les données de cotes, référencées dans la suite par données <code>odds</code>, contiennent les cotes proposées
 par le bookmaker B365 pour le paris "inférieur/supérieur à 2.5 buts" pour un historique de matchs
 de football masculin. Le Tableau  <a href="#org3f630f2">1</a> présente une description succintes des
 variables présentes. 
</p>

<table id="org3f630f2" border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Tableau 1 :</span> Définition des variables du jeu de données <code>odds</code>.</caption>

<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Colonne</th>
<th scope="col" class="org-left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">league_id</td>
<td class="org-left">Identifiant du championnat</td>
</tr>

<tr>
<td class="org-left">season_id</td>
<td class="org-left">Identifiant de la saison</td>
</tr>

<tr>
<td class="org-left">Date</td>
<td class="org-left">Date du match au format %Y-%m-%d</td>
</tr>

<tr>
<td class="org-left">HomeTeam</td>
<td class="org-left">Équipe à domicile (ED)</td>
</tr>

<tr>
<td class="org-left">AwayTeam</td>
<td class="org-left">Équipe à l'exterieur (EE)</td>
</tr>

<tr>
<td class="org-left">FTG_2.5</td>
<td class="org-left">Événement : '&lt;2.5' : 2 buts ou moins ont été inscrits dans le match'&gt;2.5' : au moins 3 buts ont été inscrits dans le match</td>
</tr>

<tr>
<td class="org-left">odds</td>
<td class="org-left">Cote de l'événement</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="outline-container-orge0ddcd1" class="outline-3">
<h3 id="orge0ddcd1"><span class="section-number-3">2.2.</span> Chargement des données</h3>
<div class="outline-text-3" id="text-2-2">
<p>
Nous allons tout d'abord charger les données <code>odds</code> dans notre environnement
<code>Python</code> en utilisant la librairie <code>Pandas</code>.
Ces données sont accessibles <i>via</i> les liens suivants :
</p>


<p>
<b>Travail à réaliser :</b>
</p>
<ol class="org-ol">
<li>Lire les données depuis le lien 
<a href="https://roland-donat.github.io/ubs-lpmds-python/td/data/odds.csv.bz2">https://roland-donat.github.io/ubs-lpmds-python/td/data/odds.csv.bz2</a> et stocker les dans un
<code>DataFrame</code> nommé <code>odds_df</code>.</li>
<li>Analyser rapidement les données avec les méthodes <code>.head</code>, <code>.info</code> et <code>.describe</code>.</li>

<li>Ajuster le type des colonnes.</li>
<li>Que remarquez-vous sur la structure de ces données ? Chaque ligne est-elle associée à un match
différent ?</li>
</ol>
</div>
</div>
</div>


<div id="outline-container-org8d1e77d" class="outline-2">
<h2 id="org8d1e77d"><span class="section-number-2">3.</span> Premiers pas avec <code>plotly.express</code> : visualisation des cotes moyennes</h2>
<div class="outline-text-2" id="text-3">
<p>
<b>Travail à réaliser :</b>
</p>
<ol class="org-ol">
<li><p>
Importer la librairie <code>plotly.express</code> dans votre environnement.
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #F0DFAF; font-weight: bold;">import</span> plotly.express <span style="color: #F0DFAF; font-weight: bold;">as</span> px
</pre>
</div>
<p>
Vous trouverez de l'aide ainsi que de nombreuses informations sur le site de <code>plotly.express</code> : <a href="https://plotly.com/python/plotly-express/">https://plotly.com/python/plotly-express/</a>.
</p></li>

<li><p>
Afficher un diagramme en barres des cotes moyennes du pari <i>upper-under 2.5</i> avec la fonction
<code>px.bar</code>.
</p>

<p>
Pour ce faire, regroupons les données afin de calculer les cotes moyenne en fonction des
événements <code>&lt;2.5</code> et <code>&gt;2.5</code> :
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #DFAF8F;">odds_ftg_mean</span> = odds_df.groupby([<span style="color: #CC9393;">"FTG_2.5"</span>])[<span style="color: #CC9393;">"odds"</span>].mean()
</pre>
</div>
<p>
Ensuite, on appelle la fonction <code>px.bar</code> sur la <code>Series</code> <code>odds_ftg_mean</code>.
</p>
<div class="org-src-container">
<pre class="src src-python">px.bar(odds_ftg_mean)
</pre>
</div>
<p>
À noter que si une fonction <code>plotly.express</code> est utilisée avec une <code>Series</code>, alors
<code>plotly.express</code> affichera l'index de la <code>Series</code> en abscisses et les valeurs de la <code>Series</code> en
ordonnées. 
</p></li>

<li><p>
Il est important de documenter vos graphes, à savoir ajouter un titre, des labels sur les axes (en
précisant les unités si besoin), une légende si besoin, le tout en utilisant des termes lisibles
pour les humains.
</p>

<p>
Les fonctions <code>plotly.express</code> possèdent toutes un argument <code>title</code> pour ajouter un titre et un
argument <code>labels</code> pour changer les légendes proposées par défaut. 
</p>
<div class="org-src-container">
<pre class="src src-python">px.bar(odds_ftg_mean, title=<span style="color: #CC9393;">"Cotes moyennes pour le pari upper-under 2.5"</span>,
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>  labels={<span style="color: #CC9393;">"value"</span>: <span style="color: #CC9393;">"cote"</span>, <span style="color: #CC9393;">"FTG_2.5"</span>: <span style="color: #CC9393;">"Nombre de buts"</span>})
</pre>
</div>

<p>
La légende est dans ce cas de trop, pour la supprimer, il faut utiliser le code suivant :
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #DFAF8F;">fig</span> = px.bar(odds_ftg_mean, title=<span style="color: #CC9393;">"Cotes moyennes pour le pari upper-under 2.5"</span>,
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>labels={<span style="color: #CC9393;">"value"</span>: <span style="color: #CC9393;">"cote"</span>, <span style="color: #CC9393;">"FTG_2.5"</span>: <span style="color: #CC9393;">"Nombre de buts"</span>})
fig.update_layout(showlegend=<span style="color: #BFEBBF;">False</span>)
fig
</pre>
</div>

<p>
La taille des barres est par défaut exagérée quand il y a peu de barres à afficher. Vous pouvez
la modifier avec la méthode <code>update_traces</code> d'un objet <code>plotly</code> :
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #DFAF8F;">fig</span> = px.bar(odds_ftg_mean, title=<span style="color: #CC9393;">"Cotes moyennes pour le pari upper-under 2.5"</span>,
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>labels={<span style="color: #CC9393;">"value"</span>: <span style="color: #CC9393;">"cote"</span>, <span style="color: #CC9393;">"FTG_2.5"</span>: <span style="color: #CC9393;">"Nombre de buts"</span>})
fig.update_layout(showlegend=<span style="color: #BFEBBF;">False</span>)
fig.update_traces(width=0.25)
fig
</pre>
</div>

<p>
Enfin, il est possible d'ajuster la largeur et la hauteur du graphe avec les arguments <code>width</code> et
<code>height</code> comme suit :
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #DFAF8F;">fig</span> = px.bar(odds_ftg_mean, title=<span style="color: #CC9393;">"Cotes moyennes pour le pari upper-under 2.5"</span>,
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>labels={<span style="color: #CC9393;">"value"</span>: <span style="color: #CC9393;">"cote"</span>, <span style="color: #CC9393;">"FTG_2.5"</span>: <span style="color: #CC9393;">"Nombre de buts"</span>},
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>width=600, height= 600)
fig.update_layout(showlegend=<span style="color: #BFEBBF;">False</span>)
fig.update_traces(width=0.5)
fig
</pre>
</div></li>

<li>Calculer la moyenne des cotes pour le pari <i>upper-under 2.5</i> pour chaque championnat. Le résultat
sera mis sous la forme d'un <code>DataFrame</code> nommé <code>odds_league_id_ftg_mean_df</code> contenant une colonne
<code>league_id</code>, une colonne <code>FTG_2.5</code> et une colonne <code>odds</code>.</li>
<li><p>
On peut alors réaliser un diagramme en bar pour visualiser la moyenne des cotes pour le pari <i>upper-under 2.5</i>
pour chaque championnat :
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #DFAF8F;">fig</span> = px.bar(odds_league_id_ftg_mean_df,
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>x=<span style="color: #CC9393;">"FTG_2.5"</span>,
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>y=<span style="color: #CC9393;">"odds"</span>,
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>color=<span style="color: #CC9393;">"league_id"</span>,
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>title=<span style="color: #CC9393;">"Cotes moyennes pour le pari upper-under 2.5 par championnat"</span>,
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>labels={<span style="color: #CC9393;">"odds"</span>: <span style="color: #CC9393;">"cote"</span>, <span style="color: #CC9393;">"FTG_2.5"</span>: <span style="color: #CC9393;">"Nombre de buts"</span>},
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>width=600, height= 600)
fig.update_traces(width=0.5)
fig
</pre>
</div>
<p>
Points notables :
</p>
<ul class="org-ul">
<li>Quand on utilise un <code>DataFrame</code> comme premier argument d'une fonction <code>plotly.express</code>, il faut
préciser les colonnes à utiliser dans la construction du graphe.</li>
<li>Dans cet exemple, on utilise la colonne <code>FTG_2.5</code> en abscisses ; la colonne <code>odds</code> en ordonnées
; la colonne <code>league_id</code> pour la coloration.</li>
</ul></li>

<li>Modifier dans le graphique précédent le titre de la légende "league_id" en "Championnat".</li>
<li>Utiliser l'argument <code>barmode</code> afin d'afficher une barre par championnat (mode <code>"group"</code>) au lieu
de la représentation empilée (mode <code>"stack"</code>) précédente.</li>
<li>Reprendre le graphique précédent en affichant à présent le championnat en abscisses avec une
coloration sur la colonne du nombre de buts.</li>
<li>Comparer les deux visualisations précédentes en termes d'informations apportées.</li>
</ol>
</div>
</div>

<div id="outline-container-org001ee81" class="outline-2">
<h2 id="org001ee81"><span class="section-number-2">4.</span> Distribution des cotes</h2>
<div class="outline-text-2" id="text-4">
<p>
Pour représenter une distribution, on utilise usuellement les boites à moustaches (boxplot) et les
histogrammes.
</p>
</div>

<div id="outline-container-org5c1f7e8" class="outline-3">
<h3 id="org5c1f7e8"><span class="section-number-3">4.1.</span> Utilisation d'un <i>boxplot</i></h3>
<div class="outline-text-3" id="text-4-1">
<p>
<b>Travail à réaliser :</b>
</p>
<ol class="org-ol">
<li><p>
Construire un <i>boxplot</i>, en utilisant la fonction <code>px.box</code>, afin de visualiser la distribution des
cotes pour chacune des deux issues possibles du pari <i>upper-under 2.5</i>.
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #DFAF8F;">fig</span> = px.box(odds_df,
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>x=<span style="color: #CC9393;">"FTG_2.5"</span>,
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>y=<span style="color: #CC9393;">"odds"</span>,
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>title=<span style="color: #CC9393;">"Distribution des cotes pour le pari upper-under 2.5"</span>,
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>labels={<span style="color: #CC9393;">"odds"</span>: <span style="color: #CC9393;">"cote"</span>, <span style="color: #CC9393;">"FTG_2.5"</span>: <span style="color: #CC9393;">"Nombre de buts"</span>},
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>width=600, height= 600)
fig.update_traces(width=0.5)
fig
</pre>
</div></li>

<li><p>
Afin d'analyser les valeurs extrêmes, il peut être utile d'ajouter plus d'informations dans la
<i>tooltip</i> qui s'affiche en survolant un point du graphique. Les fonctions <code>plotly.express</code>
possèdent en général l'argument <code>hover_data</code> permettant d'enrichir les <i>tooltips</i>. Par exemple,
pour afficher toutes les informations disponibles sur la rencontre, il faut écrire : 
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #DFAF8F;">fig</span> = px.box(odds_df,
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>x=<span style="color: #CC9393;">"FTG_2.5"</span>,
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>y=<span style="color: #CC9393;">"odds"</span>,
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>title=<span style="color: #CC9393;">"Distribution des cotes pour le pari upper-under 2.5"</span>,
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>labels={<span style="color: #CC9393;">"odds"</span>: <span style="color: #CC9393;">"cote"</span>, <span style="color: #CC9393;">"FTG_2.5"</span>: <span style="color: #CC9393;">"Nombre de buts"</span>},
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>hover_data=<span style="color: #DCDCCC; font-weight: bold;">list</span>(odds_df.columns),
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>width=600, height= 600)
fig.update_traces(width=0.5)
fig
</pre>
</div></li>

<li>Dans les <i>tooltips</i> du graphique précédent, changer le nom des colonnes en termes du langage
naturel, par exemple : <code>"league_id"</code> en <code>"Championnat"</code>, <code>"season_id"</code> en <code>"Saison"</code>, etc.</li>
<li>Construire un <code>boxplot</code> représentant l'évolution de la distribution des cotes de chacun des deux
événements en fonction des saisons (en abscisses).</li>
<li>Mettre à jour le graphique précédent pour que l'axe des abscisses soit ordonné par saison
croissante. Aide : utiliser l'argument <a href="https://plotly.com/python/categorical-axes/"><code>category_orders</code></a>.</li>
</ol>
</div>
</div>
<div id="outline-container-orgc84e452" class="outline-3">
<h3 id="orgc84e452"><span class="section-number-3">4.2.</span> Utilisation d'un histogramme</h3>
<div class="outline-text-3" id="text-4-2">
<p>
<b>Travail à réaliser :</b>
</p>
<ol class="org-ol">
<li><p>
La fonction <code>px.histogram</code> permet de construire des histogrammes. Nous pouvons donc représenter la
distribution des cotes pour chacun des deux événements avec le code suivant :
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #DFAF8F;">fig_labels</span> = {
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #CC9393;">"league_id"</span>: <span style="color: #CC9393;">"Championnat"</span>,
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #CC9393;">"season_id"</span>: <span style="color: #CC9393;">"Saison"</span>,
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #CC9393;">"HomeTeam"</span>: <span style="color: #CC9393;">"&#201;quipe &#224; domicile"</span>,
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #CC9393;">"AwayTeam"</span>: <span style="color: #CC9393;">"&#201;quipe &#224; l'exterieur"</span>,
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #CC9393;">"FTG_2.5"</span>: <span style="color: #CC9393;">"Nombre de buts"</span>,    
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #CC9393;">"odds"</span>: <span style="color: #CC9393;">"Cote"</span>,
}

px.histogram(odds_df,
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>color=<span style="color: #CC9393;">"FTG_2.5"</span>,
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>x=<span style="color: #CC9393;">"odds"</span>,
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>title=<span style="color: #CC9393;">"Distribution des cotes pour le pari upper-under 2.5"</span>,
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>labels=fig_labels)
</pre>
</div>
<p>
Utiliser une coloration pour afficher deux histogrammes sur le même graphique aboutit la plupart
du temps à un résultat peu lisible. Il est donc préférable de séparer les graphiques. Pour ce
faire, les fonctions graphiques de <code>plotly.express</code> disposent des arguments <code>facet_col</code> et
<code>facet_row</code> permettant de créer des sous-graphiques (en colonnes et en lignes) en fonction d'une
d'une variable catégorielle présente dans les données. Par exemple, pour créer deux sous
graphiques en fonction des deux événements <code>&lt;2.5</code> et <code>&gt;2.5</code> :
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #DFAF8F;">fig</span> = px.histogram(odds_df,
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>  color=<span style="color: #CC9393;">"FTG_2.5"</span>,
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>  facet_row=<span style="color: #CC9393;">"FTG_2.5"</span>,
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>  x=<span style="color: #CC9393;">"odds"</span>,
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>  title=<span style="color: #CC9393;">"Distribution des cotes pour le pari upper-under 2.5"</span>,
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>  labels=fig_labels)
<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">La l&#233;gende devient superflue </span>
fig.update_layout(showlegend=<span style="color: #BFEBBF;">False</span>)
fig
</pre>
</div></li>
<li>Créer les histogrammes de cotes pour chacun des deux événements et en fonction du championnat
avec un seul appel à la fonction <code>px.histogram</code>.</li>
</ol>
</div>
</div>
</div>
<div id="outline-container-org2ccfef8" class="outline-2">
<h2 id="org2ccfef8"><span class="section-number-2">5.</span> Analyse des probabilités estimées par le bookmaker</h2>
<div class="outline-text-2" id="text-5">
<p>
La Section <a href="#sec:odds_df">2</a> explique comment passer de la cote proposée par un bookmaker pour un
événement donné à son estimation de la probabilité d'occurrence dudit événement.
</p>

<p>
Travailler sur les probabilités estimées par le bookmaker est plus intuitif, car plus facile à
comparer avec nos propres calculs de probabilités. Par ailleurs, une probabilité est nécessairement
encadrée entre 0 et 1 tandis qu'une cote n'est théoriquement pas bornée à droite entraînant des
problèmes d'échelles liés aux valeurs extrêmes.
</p>


<p>
<b>Travail à réaliser :</b>
</p>
<ol class="org-ol">
<li>Ajouter une colonne <code>prob</code> au DataFrame <code>odds_df</code> contenant la probabilité estimée de
chacun des deux événements <code>&lt;2.5</code> et <code>&gt;2.5</code> par le bookmaker.</li>
<li>Représenter graphiquement la distribution des probabilités estimées calculées précédemment pour
chaque événement, chaque saison et chaque championnat.</li>
<li>Calculer pour chaque match la somme des probabilités estimées par le bookmaker des deux événements
<code>&lt;2.5</code> et <code>&gt;2.5</code> <b>moins un</b>. Le résultat sera stocké dans un nouveau <code>DataFrame</code> nommé
<code>marge_ftg_df</code> et la colonne contenant la somme moins un sera nommée <code>marge</code>.</li>
<li>Que représente les valeurs de la colonne <code>marge</code> à votre avis ?</li>

<li>Représenter avec la fonction <code>px.scatter</code>, le nuage de points des matchs caractérisés par leur
marge et la probabilité estimée de l'événement <code>"&lt;2.5"</code>, et ce, en créant un
sous-graphique par championnat et par saison. On ne s'intéressera qu'aux données des saisons
2019-2020 et 2020-2021.</li>
</ol>
</div>
</div>
</div>
</body>
</html>
