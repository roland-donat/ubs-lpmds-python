<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="fr" xml:lang="fr">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Analyses décisionnelles</title>
<meta name="author" content="Roland Donat" />
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/css/readtheorg.css"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/lib/js/jquery.stickytableheaders.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/js/readtheorg.js"></script>
<link rel="stylesheet" type="text/css" href="https://roland-donat.github.io/ubs/Charte_graphique/IUT/ubs_iut_vannes.css" />
<link rel="stylesheet" type="text/css" href="https://roland-donat.github.io/ubs-lpmds-python/custom.css" />
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "0em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "right",
               TagIndent: ".8em"
             }
});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML"></script>
</head>
<body>
<div id="content" class="content">
<h1 class="title">Analyses décisionnelles</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table des matières</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org8fd3709">1. Contexte</a></li>
<li><a href="#orga223dda">2. Données historiques</a>
<ul>
<li><a href="#orgd2049d9">2.1. Présentation des données</a></li>
<li><a href="#org1e14940">2.2. Chargement des données</a></li>
<li><a href="#orgf6773a8">2.3. Vérification des indicateurs glissants moyens</a></li>
</ul>
</li>
<li><a href="#org0594e43">3. Modélisation décisionnelle</a>
<ul>
<li><a href="#org2fcc7b6">3.1. Généralité</a></li>
<li><a href="#org8089c6c">3.2. Modèle empirique <i>a priori</i></a></li>
<li><a href="#orgb818d38">3.3. Modèle empirique <code>HSHT_MA3</code></a></li>
</ul>
</li>
</ul>
</div>
</div>






<div id="org458c2dd" class="figure">
<p><img src="https://www.agent-x.com.au/wp-content/uploads/2011/06/Perfect-Programmer-dfe194b-e8d3b11-b960bd5.jpg" alt="Perfect-Programmer-dfe194b-e8d3b11-b960bd5.jpg" />
</p>
</div>


<div id="outline-container-org8fd3709" class="outline-2">
<h2 id="org8fd3709"><span class="section-number-2">1.</span> Contexte</h2>
<div class="outline-text-2" id="text-1">
<p>
Dans les TD précédents, nous avons pris connaissance de la librairie <code>Pandas</code> en explorant certaines
de ses fonctionnalités pour la manipulation des données sous <code>Python</code>. Nous avons également réalisé
des premières analyses descriptives graphiques avec la librairie <code>plotly.express</code>.
</p>

<p>
Rappelons que le fil rouge de nos TD est l'analyse réalisation de pronostics sur des matchs 
de football. Il s'agit donc à présent de se pencher sur cette notion de pronostic et de comprendre
en quoi l'analyse de données va nous être d'une aide précicieuse.
</p>

<p>
Les objectifs de ce TD sont :
</p>
<ul class="org-ul">
<li>Approfondir ses compétences en traitement des données sous <code>Python</code>.</li>
<li>Construire un premier algorithme de pronostic.</li>
<li>Développer une méthode d'évaluation des pronostics réalisés.</li>
<li>Chercher des idées pour améliorer votre premier algorithme.</li>
</ul>

<p>
<b>Rappels :</b>
</p>
<ul class="org-ul">
<li>Créez un <i>notebook</i> dans le lequel vous allez écrire, exécuter et documenter votre code <code>Python</code>.</li>
<li>Prenez le temps de bien présenter et bien rédiger votre <i>notebook</i>.</li>
</ul>
</div>
</div>

<div id="outline-container-orga223dda" class="outline-2">
<h2 id="orga223dda"><span class="section-number-2">2.</span> Données historiques</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-orgd2049d9" class="outline-3">
<h3 id="orgd2049d9"><span class="section-number-3">2.1.</span> Présentation des données</h3>
<div class="outline-text-3" id="text-2-1">
<p>
Comme dans les TD précédents, les données historiques, référencées dans la suite par données
 <code>fixtures</code>, contiennent un historique de matchs sur différents championnats. Le Tableau
 <a href="#orgb9ad1e8">1</a> présente  une description succintes des variables présentes.
</p>

<table id="orgb9ad1e8" border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Tableau 1 :</span> Définition des variables du jeu de données <code>fixtures</code>.</caption>

<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Colonne</th>
<th scope="col" class="org-left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">league_id</td>
<td class="org-left">Identifiant du championnat</td>
</tr>

<tr>
<td class="org-left">season_id</td>
<td class="org-left">Identifiant de la saison</td>
</tr>

<tr>
<td class="org-left">Date</td>
<td class="org-left">Date du match au format %Y-%m-%d</td>
</tr>

<tr>
<td class="org-left">HTeam</td>
<td class="org-left">Équipe à domicile (ÉD)</td>
</tr>

<tr>
<td class="org-left">ATeam</td>
<td class="org-left">Équipe à l'extérieure (ÉE)</td>
</tr>

<tr>
<td class="org-left">HGHT</td>
<td class="org-left">Nombre de buts inscrit à la mi-temps (ÉD)</td>
</tr>

<tr>
<td class="org-left">AGHT</td>
<td class="org-left">Nombre de buts inscrit à la mi-temps (ÉE)</td>
</tr>

<tr>
<td class="org-left">HGFT</td>
<td class="org-left">Nombre de buts inscrit à la fin du match (ÉD)</td>
</tr>

<tr>
<td class="org-left">AGFT</td>
<td class="org-left">Nombre de buts inscrit à la fin du match (ÉE)</td>
</tr>

<tr>
<td class="org-left">RHT</td>
<td class="org-left">Résultat à la mi-temps (H = ED gagne, D = match nul, A = EE gagne)</td>
</tr>

<tr>
<td class="org-left">RFT</td>
<td class="org-left">Résultat à la fin du match (H = ED gagne, D = match nul, A = EE gagne)</td>
</tr>

<tr>
<td class="org-left">ARND</td>
<td class="org-left">Numéro de journée (ÉE)</td>
</tr>

<tr>
<td class="org-left">HRND</td>
<td class="org-left">Numéro de journée (ÉD)</td>
</tr>

<tr>
<td class="org-left">ASHT_MA3</td>
<td class="org-left">Nombre de tirs cadrés moyen sur les 3 derniers matchs (ÉE)</td>
</tr>

<tr>
<td class="org-left">HSHT_MA3</td>
<td class="org-left">Nombre de tirs cadrés moyen sur les 3 derniers matchs (ÉD)</td>
</tr>

<tr>
<td class="org-left">HSHT</td>
<td class="org-left">Nombre de tirs cadrés (ÉD)</td>
</tr>

<tr>
<td class="org-left">ASHT</td>
<td class="org-left">Nombre de tirs cadrés (ÉE)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="outline-container-org1e14940" class="outline-3">
<h3 id="org1e14940"><span class="section-number-3">2.2.</span> Chargement des données</h3>
<div class="outline-text-3" id="text-2-2">
<p>
<b>Travail à réaliser :</b>
</p>
<ol class="org-ol">
<li><p>
Charger les données historiques dans votre environnement :
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #F0DFAF; font-weight: bold;">import</span> pandas <span style="color: #F0DFAF; font-weight: bold;">as</span> pd

<span style="color: #DFAF8F;">fixtures_url</span> = <span style="color: #CC9393;">"https://roland-donat.github.io/ubs-lpmds-python/td/data/fixtures_indics_all.csv.bz2"</span>
<span style="color: #DFAF8F;">fixtures_df</span> = pd.read_csv(fixtures_url, sep=<span style="color: #CC9393;">";"</span>, compression=<span style="color: #CC9393;">"bz2"</span>)
</pre>
</div></li>
</ol>
</div>
</div>

<div id="outline-container-orgf6773a8" class="outline-3">
<h3 id="orgf6773a8"><span class="section-number-3">2.3.</span> Vérification des indicateurs glissants moyens</h3>
<div class="outline-text-3" id="text-2-3">
<p>
La variable <code>HSHT_MA3</code> (resp. <code>ASHT_MA3</code>) représente le nombre de tirs cadrés moyens sur les trois
derniers matchs réalisé par l'équipe à domicile (resp. l'équipe à l'extérieur).
</p>

<p>
Pour calculer ces variables pour une équipe à une journée donnée, il faut faire la moyenne des tirs
cadrés de cette équipe sur les trois dernière journées passées.
</p>

<p>
Le Tableau <a href="#orgb89fab9">2</a> présente les données des 10 premiers matchs de Lorient sur la saison
2021-2022. 
</p>

<table id="orgb89fab9" border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Tableau 2 :</span> Définition des variables du jeu de données <code>fixtures</code>.</caption>

<colgroup>
<col  class="org-right" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-left" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">Date</th>
<th scope="col" class="org-left">HTeam</th>
<th scope="col" class="org-left">ATeam</th>
<th scope="col" class="org-right">HRND</th>
<th scope="col" class="org-right">ARND</th>
<th scope="col" class="org-right">HGFT</th>
<th scope="col" class="org-right">AGFT</th>
<th scope="col" class="org-left">RFT</th>
<th scope="col" class="org-right">HSHT</th>
<th scope="col" class="org-right">ASHT</th>
<th scope="col" class="org-right">HSHT_MA3</th>
<th scope="col" class="org-right">ASHT_MA3</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">2021-08-08</td>
<td class="org-left">St Etienne</td>
<td class="org-left">Lorient</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-left">D</td>
<td class="org-right">3</td>
<td class="org-right">3</td>
<td class="org-right">nan</td>
<td class="org-right">nan</td>
</tr>

<tr>
<td class="org-right">2021-08-13</td>
<td class="org-left">Lorient</td>
<td class="org-left">Monaco</td>
<td class="org-right">2</td>
<td class="org-right">2</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-left">H</td>
<td class="org-right">2</td>
<td class="org-right">3</td>
<td class="org-right">nan</td>
<td class="org-right">nan</td>
</tr>

<tr>
<td class="org-right">2021-08-22</td>
<td class="org-left">Montpellier</td>
<td class="org-left">Lorient</td>
<td class="org-right">3</td>
<td class="org-right">3</td>
<td class="org-right">3</td>
<td class="org-right">1</td>
<td class="org-left">H</td>
<td class="org-right">11</td>
<td class="org-right">4</td>
<td class="org-right">nan</td>
<td class="org-right">nan</td>
</tr>

<tr>
<td class="org-right">2021-08-29</td>
<td class="org-left">Lens</td>
<td class="org-left">Lorient</td>
<td class="org-right">4</td>
<td class="org-right">4</td>
<td class="org-right">2</td>
<td class="org-right">2</td>
<td class="org-left">D</td>
<td class="org-right">9</td>
<td class="org-right">7</td>
<td class="org-right">5</td>
<td class="org-right">3</td>
</tr>

<tr>
<td class="org-right">2021-09-10</td>
<td class="org-left">Lorient</td>
<td class="org-left">Lille</td>
<td class="org-right">5</td>
<td class="org-right">5</td>
<td class="org-right">2</td>
<td class="org-right">1</td>
<td class="org-left">H</td>
<td class="org-right">7</td>
<td class="org-right">3</td>
<td class="org-right">4.33333</td>
<td class="org-right">4</td>
</tr>

<tr>
<td class="org-right">2021-09-19</td>
<td class="org-left">Reims</td>
<td class="org-left">Lorient</td>
<td class="org-right">6</td>
<td class="org-right">6</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-left">D</td>
<td class="org-right">2</td>
<td class="org-right">3</td>
<td class="org-right">3.33333</td>
<td class="org-right">6</td>
</tr>

<tr>
<td class="org-right">2021-09-22</td>
<td class="org-left">Lorient</td>
<td class="org-left">Nice</td>
<td class="org-right">7</td>
<td class="org-right">6</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-left">H</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">5.66667</td>
<td class="org-right">3.66667</td>
</tr>

<tr>
<td class="org-right">2021-09-25</td>
<td class="org-left">Lyon</td>
<td class="org-left">Lorient</td>
<td class="org-right">8</td>
<td class="org-right">8</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-left">D</td>
<td class="org-right">2</td>
<td class="org-right">5</td>
<td class="org-right">6.66667</td>
<td class="org-right">3.66667</td>
</tr>

<tr>
<td class="org-right">2021-10-03</td>
<td class="org-left">Lorient</td>
<td class="org-left">Clermont</td>
<td class="org-right">9</td>
<td class="org-right">9</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-left">D</td>
<td class="org-right">1</td>
<td class="org-right">4</td>
<td class="org-right">3</td>
<td class="org-right">3</td>
</tr>

<tr>
<td class="org-right">2021-10-17</td>
<td class="org-left">Marseille</td>
<td class="org-left">Lorient</td>
<td class="org-right">9</td>
<td class="org-right">10</td>
<td class="org-right">4</td>
<td class="org-right">1</td>
<td class="org-left">H</td>
<td class="org-right">6</td>
<td class="org-right">7</td>
<td class="org-right">2.66667</td>
<td class="org-right">2.33333</td>
</tr>
</tbody>
</table>

<p>
<b>Travail à réaliser :</b>
</p>
<ol class="org-ol">
<li>Pourquoi les 3 premières valeurs des colonnes <code>HSHT_MA3</code> et <code>ASHT_MA3</code> valent <code>nan</code> ?</li>
<li>Vérifier que la valeur de l'indicateur <code>ASHT_MA3</code> est correct en date du 29/08/2021.</li>
<li>Calculer la valeur de l'indicateur de tirs cadrés moyen sur les 3 derniers matchs pour Lorient
lors de sa 11ème journée.</li>
</ol>
</div>
</div>
</div>

<div id="outline-container-org0594e43" class="outline-2">
<h2 id="org0594e43"><span class="section-number-2">3.</span> Modélisation décisionnelle</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-org2fcc7b6" class="outline-3">
<h3 id="org2fcc7b6"><span class="section-number-3">3.1.</span> Généralité</h3>
<div class="outline-text-3" id="text-3-1">
<p>
Dans le cadre de ce TD, nous proposons de réaliser des pronostics sur le nombre total des buts
inscrits lors d'une rencontre. Afin de simplifier la problématique, nous cherchons uniquement à
déterminer si le nombre de buts inscrit est inférieur ou supérieur à 2.
</p>

<p>
D'un point de vue probabiliste, on note <code>NGFT2.5</code>, la variable aléatoire représentant le nombre de
buts inscrit sur une rencontre discrétisé au seuil de 2.5 buts. Il s'agit donc d'une variable
binaire ayant pour valeurs <code>&lt;2.5</code> ou <code>&gt;2.5</code>.
</p>

<p>
La variable <code>NGFT2.5</code> est appelée variable cible ou variable à expliquer du problème
décisionnel. L'objectif est alors de prévoir/pronostiquer les valeurs de la variable cible à partir 
d'observations de variables disponibles. Ces variables observées sont appelées variables
explicatives.
</p>

<p>
Formellement, notre problème de pronostic revient alors à estimer la probabilité
</p>
\begin{equation}
\label{org5e8e2fa}
P(\text{NGFT2.5} = \text{<2.5} | X_{1} = x_{1}, \ldots, X_{n} = x_{n})
\end{equation}
<p>
où \(x_{1}, \ldots, x_{n}\) sont des observations des variables explicatives \(X_{1}, \ldots,
X_{n}\) que nous avons choisi d'utiliser dans nos pronostics. L'estimation de cette probabilité est
réalisée en pratique à partir des données disponibles pour lesquelles on observe à la fois la
variable cible et les variables explicative. Cependant, l'estimation empirique directe de cette
probabilité s'avère souvent difficile d'un point de vue informatique, soit par manque de données,
soit parce que le calcul n'est pas réalisable en un temps raisonnable.
</p>

<p>
Pour contourner ce problème, on approche la probabilité \eqref{org5e8e2fa} par une fonction plus
simple à calculer. Cette fonction est également appelée modèle décisionnel, par exemple, le modèle
de régression logistique utilise la fonction \(\text{logit}\). 
</p>

<p>
En notant \(\hat{p}_{\text{<2.5}}(x_{1}, \ldots, x_{n})\) l'estimation de la probabilité
\eqref{org5e8e2fa} obtenue par le modèle décisionnel utilisé, nous pouvons déduire la règle de 
décision \(\text{R}_{\text{NGFT2.5}}\) générale suivante :
</p>
\begin{equation}
\text{R}_{\text{NGFT2.5}}(x_{1}, \ldots, x_{n}) =
\begin{cases}
\text{<2.5} & \text{si}~ \hat{p}_{\text{<2.5}}(x_{1}, \ldots, x_{n}) > \delta, \\
\text{>2.5} & \text{sinon},
\end{cases}
\end{equation}
<p>
où \(\delta \in [0, 1]\) est appelé seuil de décision. Il est courant de poser dans un premier temps
\(\delta = 0.5\). Toutefois, le seuil de décision est un paramètre fondammental du processus de
décision qui peut notamment être optimisé en fonction :
</p>
<ul class="org-ul">
<li>des conséquences occasionnées par les erreurs de pronostic et des récompenses induites par les
bons pronostics ;</li>
<li>la probabilité <i>a priori</i> d'observer plus ou moins de 2.5 buts.</li>
</ul>

<p>
<b>Travail à réaliser :</b>
</p>
<ol class="org-ol">
<li><p>
Ajouter au <code>DataFrame</code> <code>fixtures_df</code> une nouvelle variable <code>NGFT</code> contenant le nombre de buts
inscrits lors de chaque rencontre. 
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">SOLUTION</span>
<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">--------</span>
<span style="color: #DFAF8F;">fixtures_df</span>[<span style="color: #CC9393;">"NGFT"</span>] = fixtures_df[<span style="color: #CC9393;">"HGFT"</span>] + fixtures_df[<span style="color: #CC9393;">"AGFT"</span>]
</pre>
</div></li>

<li><p>
Créer ensuite la variable <code>NGFT2.5</code> en discrétisant la variable <code>NGFT</code> sur les ensembles
\([0, 2.5[\) et \([2.5, \infty[\) à l'aide de la fonction <code>pd.cut</code> :
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #DFAF8F;">fixtures_df</span>[<span style="color: #CC9393;">"NGFT2.5"</span>] = pd.cut(fixtures_df[<span style="color: #CC9393;">"NGFT"</span>],
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   bins=[0, 2.5, <span style="color: #DCDCCC; font-weight: bold;">float</span>(<span style="color: #CC9393;">"inf"</span>)])
</pre>
</div>
<p>
Le paramètre <code>bins</code> permet de spécifier les bornes des intervalles de discrétisation. Observer le
résultat de la discrétisation, quel est le type de la <code>Series</code> obtenue ? Le résultat est-il
conforme à l'attendu ?
</p>

<p>
Il est important de remarquer que la fonction <code>pd.cut</code> crée des intervalles ouverts à gauche et fermés à
droite. Il faut donc être vigilant en fixant les bornes de discrétisation en s'assurant en
particulier que les observations égales aux bornes ne soient pas exclues ou placées dans un
intervalle de discrétisation incorrect.
</p>

<p>
Pour corriger le problème, discrétiser la variable <code>NGFT</code> sur les ensembles
\([-\infty, 2.5[\) et \([2.5, \infty[\) à l'aide de la fonction <code>pd.cut</code> : 
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #DFAF8F;">fixtures_df</span>[<span style="color: #CC9393;">"NGFT2.5"</span>] = pd.cut(fixtures_df[<span style="color: #CC9393;">"NGFT"</span>],
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   bins=[-<span style="color: #DCDCCC; font-weight: bold;">float</span>(<span style="color: #CC9393;">"inf"</span>), 2.5, <span style="color: #DCDCCC; font-weight: bold;">float</span>(<span style="color: #CC9393;">"inf"</span>)])
</pre>
</div>

<p>
Enfin, la fonction <code>pd.cut</code> permet de discrétiser une variable en labélisant les intervalles de
discrétisation. Par exemple, pour associer le label <code>&lt;2.5</code> à l'intervalle \([-\infty, 2.5[\) et le
label <code>&gt;2.5</code> à l'intervalle \([2.5, \infty[\), il faut écrire :
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #DFAF8F;">fixtures_df</span>[<span style="color: #CC9393;">"NGFT2.5"</span>] = pd.cut(fixtures_df[<span style="color: #CC9393;">"NGFT"</span>],
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   bins=[-<span style="color: #DCDCCC; font-weight: bold;">float</span>(<span style="color: #CC9393;">"inf"</span>), 2.5, <span style="color: #DCDCCC; font-weight: bold;">float</span>(<span style="color: #CC9393;">"inf"</span>)],
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   labels=[<span style="color: #CC9393;">"&lt;2.5"</span>, <span style="color: #CC9393;">"&gt;2.5"</span>])
</pre>
</div></li>

<li><p>
Représenter graphiquement l'évolution de la proportion de match à plus de 2.5 buts au fil des saisons, et
ce, pour chaque championnat. Utiliser <code>px.line</code> pour construire le diagramme en lignes
correspondant en affichant une ligne de couleur différente par championnat.
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">SOLUTION</span>
<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">--------</span>
<span style="color: #DFAF8F;">ngft_prop_df</span> = \
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   fixtures_df.groupby([<span style="color: #CC9393;">"season_id"</span>, <span style="color: #CC9393;">"league_id"</span>])[<span style="color: #CC9393;">"NGFT2.5"</span>]\
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   .value_counts(normalize=<span style="color: #BFEBBF;">True</span>)\
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   .unstack()\
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   .reset_index()

<span style="color: #DFAF8F;">fig</span> = \
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   px.line(ngft_prop_df,
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   x=<span style="color: #CC9393;">"season_id"</span>,
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   y=<span style="color: #CC9393;">"&gt;2.5"</span>,
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   color=<span style="color: #CC9393;">"league_id"</span>,
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   markers=<span style="color: #BFEBBF;">True</span>,
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   title=<span style="color: #CC9393;">"&#201;volution de la proportion de match &#224; plus de 2.5 buts au fil des saisons"</span>,
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   labels={<span style="color: #CC9393;">"season_id"</span>: <span style="color: #CC9393;">"Saison"</span>, <span style="color: #CC9393;">"&gt;2.5"</span>: <span style="color: #CC9393;">"Proportion"</span>, <span style="color: #CC9393;">"league_id"</span>: <span style="color: #CC9393;">"Championnat"</span>})

fig.update_layout(yaxis_tickformat=<span style="color: #CC9393;">".0%"</span>)
fig
</pre>
</div></li>

<li>Donner des exemples de variables explicatives directement disponibles dans les données <code>fixtures</code>
que vous pourriez utiliser pour pronostiquer s'il y aura plus ou moins de 2.5 buts dans un match.</li>

<li>Dans le cadre d'un pari sportif, quelle est la conséquence d'un mauvais pronostic et quel est le
bénéfice d'un pronostic correct ?</li>
</ol>
</div>
</div>

<div id="outline-container-org8089c6c" class="outline-3">
<h3 id="org8089c6c"><span class="section-number-3">3.2.</span> Modèle empirique <i>a priori</i></h3>
<div class="outline-text-3" id="text-3-2">
<p>
Le modèle empirique <i>a priori</i> consiste à ne pas tenir compte de variables explicatives dans le
processus décisionnel.
</p>

<p>
Le modèle décisionnel se formule donc simplement :
</p>
\begin{equation}
P(\text{NGFT2.5} = \text{<2.5}) \simeq \hat{p}_{\text{<2.5}} = \hat{P}(\text{NGFT2.5} = \text{<2.5})
\end{equation}
<p>
où \(\hat{P}(\text{NGFT2.5} = \text{<2.5})\) est la probabilité empirique de l'événement \(\{\text{NGFT2.5} = \text{<2.5}\}\).
</p>

<p>
<b>Travail à réaliser :</b>
</p>
<ol class="org-ol">
<li><p>
Estimer la probabilité empirique \(\hat{P}(\text{NGFT2.5} = \text{<2.5})\) à partir des données disponibles.
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">SOLUTION</span>
<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">--------</span>
<span style="color: #F0DFAF; font-weight: bold;">print</span>(fixtures_df[<span style="color: #CC9393;">"NGFT2.5"</span>].value_counts(normalize=<span style="color: #BFEBBF;">True</span>))
</pre>
</div></li>

<li><p>
En fixant la règle de pronostic suivante :
</p>
\begin{equation}
\text{R}_{\text{NGFT2.5}} =
\begin{cases}
\text{<2.5} & \text{si}~ \hat{P}(\text{NGFT2.5} = \text{<2.5}) > \delta, \\
\text{>2.5} & \text{sinon},
\end{cases}
\end{equation}

<p>
Quels seront vos pronostics avec \(\delta = 0.5\) ?
</p></li>

<li>Que deviennent les pronostics si on pose \(\delta = 0.4\).</li>

<li>Évaluer le pourcentage de bons pronostics sur les données disponibles en utilisant la règle de
décision avec \(\delta = 0.5\) et \(\delta = 0.4\). À quoi ressemble le graphique du pourcentage de
bons pronostics en fonction de \(\delta\) sur les données disponibles.</li>
</ol>
</div>
</div>

<div id="outline-container-orgb818d38" class="outline-3">
<h3 id="orgb818d38"><span class="section-number-3">3.3.</span> Modèle empirique <code>HSHT_MA3</code></h3>
<div class="outline-text-3" id="text-3-3">
<p>
Dans cette section, nous considérons le modèle empirique de pronostic de la variable <code>NGFT2.5</code>
tenant compte de la variable explicative <code>HSHT_MA3</code> uniquement.
</p>

<p>
Le modèle décisionnel s'écrit alors comme suit :
</p>
\begin{equation}
P(\text{NGFT2.5} = \text{<2.5} | \text{HSHT_MA3} = x) \simeq \hat{p}_{\text{<2.5}}(x) = \hat{P}(\text{NGFT2.5} = \text{<2.5} | \text{HSHT_MA3} = x)
\end{equation}
<p>
où \(\hat{P}(\text{NGFT2.5} = \text{<2.5} | \text{HSHT_MA3} = x)\) est la probabilité conditionnelle
empirique de l'événement \(\{\text{NGFT2.5} = \text{<2.5} | \text{HSHT_MA3} = x\}\).
</p>

<p>
<b>Travail à réaliser :</b>
</p>
<ol class="org-ol">
<li><p>
Remarquons tout d'abord que la variable <code>HSHT_MA3</code> est une variable continue ce qui n'est pas
pratique pour estimer la probabilité conditionnelle empirique \(\hat{P}(\text{NGFT2.5} =
   \text{<2.5} | \text{HSHT_MA3} = x)\). Nous proposons de simplifier le problème en discrétisant la
variable <code>HSHT_MA3</code>.
</p>

<p>
Créer une nouvelle variable <code>HSHT_MA3d</code> correspondant à la discrétisation de la variable
<code>HSHT_MA3d</code> sur les intervalles \(]-\infty, 3]\), \(]3, 6]\), \(]6, \infty[\).
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">SOLUTION</span>
<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">--------</span>
<span style="color: #DFAF8F;">fixtures_df</span>[<span style="color: #CC9393;">"HSHT_MA3d"</span>] = pd.cut(fixtures_df[<span style="color: #CC9393;">"HSHT_MA3"</span>],
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span> bins=[-<span style="color: #DCDCCC; font-weight: bold;">float</span>(<span style="color: #CC9393;">"inf"</span>), 3, 6, <span style="color: #DCDCCC; font-weight: bold;">float</span>(<span style="color: #CC9393;">"inf"</span>)])
</pre>
</div></li>

<li><p>
Estimer la probabilité conditionnelle empirique \(\hat{P}(\text{NGFT2.5} |
   \text{HSHT_MA3d}\) à partir des données disponibles et stocker le résultat dans un <code>DataFrame</code>
<code>model_msht_ma3d_df</code>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #DFAF8F;">model_msht_ma3d_df</span> = \
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   fixtures_df.groupby([<span style="color: #CC9393;">"HSHT_MA3d"</span>])[<span style="color: #CC9393;">"NGFT2.5"</span>]\
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   .value_counts(normalize=<span style="color: #BFEBBF;">True</span>)\
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   .unstack()
model_msht_ma3d_df
</pre>
</div></li>
</ol>
</div>
</div>
</div>
</div>
</body>
</html>
